<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø³Ù†Ø³ÙˆØ± ESP32</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Vazir', sans-serif;
            background: #f5f7fa;
            padding: 15px;
        }
        .card {
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
        }
        .sensor-value {
            font-size: 2.5rem;
            font-weight: bold;
        }
        .temp-card {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa8a8 100%);
            color: white;
        }
        .hum-card {
            background: linear-gradient(135deg, #4d96ff 0%, #6bc5ff 100%);
            color: white;
        }
        .status-bar {
            position: fixed;
            bottom: 0;
            right: 0;
            left: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px;
            font-size: 12px;
            text-align: center;
            z-index: 1000;
        }
        .last-update {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }
        .device-info {
            background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
            color: white;
        }
        .badge {
            font-family: monospace;
        }
    </style>
</head>
<body>
<div class="container">
    <!-- Ù‡Ø¯Ø± -->
    <div class="card bg-primary text-white">
        <div class="card-body text-center">
            <h1><i class="bi bi-graph-up"></i> Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø³Ù†Ø³ÙˆØ± ESP32</h1>
            <p>Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Real-Time Ø§Ø² ESP32 + AHT20</p>
            <div id="lastUpdate" class="last-update">
                <i class="bi bi-clock"></i> Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: --
            </div>
        </div>
    </div>

    <!-- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ù…Ø§ Ùˆ Ø±Ø·ÙˆØ¨Øª -->
    <div class="row">
        <div class="col-md-6">
            <div class="card temp-card">
                <div class="card-body text-center">
                    <h5><i class="bi bi-thermometer-half"></i> Ø¯Ù…Ø§ÛŒ ÙØ¹Ù„ÛŒ</h5>
                    <div class="sensor-value" id="currentTemp">--</div>
                    <div>Ø¯Ø±Ø¬Ù‡ Ø³Ø§Ù†ØªÛŒâ€ŒÚ¯Ø±Ø§Ø¯</div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card hum-card">
                <div class="card-body text-center">
                    <h5><i class="bi bi-moisture"></i> Ø±Ø·ÙˆØ¨Øª ÙØ¹Ù„ÛŒ</h5>
                    <div class="sensor-value" id="currentHum">--</div>
                    <div>Ø¯Ø±ØµØ¯</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ú©Ø§Ø±Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø³ØªÚ¯Ø§Ù‡ -->
    <div class="card device-info">
        <div class="card-body">
            <h5><i class="bi bi-cpu"></i> Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø³ØªÚ¯Ø§Ù‡</h5>
            <div class="row text-center">
                <div class="col-md-4">
                    <div class="mb-2">
                        <i class="bi bi-motherboard fs-4"></i>
                        <div>Ø¯Ø³ØªÚ¯Ø§Ù‡</div>
                        <div id="deviceName" class="badge bg-light text-dark fs-6">--</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-2">
                        <i class="bi bi-sensor fs-4"></i>
                        <div>Ø³Ù†Ø³ÙˆØ±</div>
                        <div id="sensorName" class="badge bg-light text-dark fs-6">--</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-2">
                        <i class="bi bi-hash fs-4"></i>
                        <div>Ø´Ù†Ø§Ø³Ù‡ Ø±Ú©ÙˆØ±Ø¯</div>
                        <div id="recordId" class="badge bg-light text-dark fs-6">--</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø¢Ø®Ø±ÛŒÙ† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ -->
    <div class="card">
        <div class="card-body">
            <h5><i class="bi bi-table"></i> Ø¯Ø§Ø¯Ù‡ ÙØ¹Ù„ÛŒ</h5>
            <div id="dataTable" class="text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ù…ÙˆØ¯Ø§Ø± Ø¯Ù…Ø§ Ùˆ Ø±Ø·ÙˆØ¨Øª -->
    <div class="card mt-4">
        <div class="card-body">
            <h5><i class="bi bi-bar-chart"></i> Ù†Ù…ÙˆØ¯Ø§Ø± ØªØºÛŒÛŒØ±Ø§Øª (Ø¢Ø®Ø±ÛŒÙ† Û±Û° Ø¯Ù‚ÛŒÙ‚Ù‡)</h5>
            <canvas id="sensorChart" height="150"></canvas>
        </div>
    </div>
</div>

<div id="statusBar" class="status-bar d-none">
    <span id="statusText">Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„...</span>
</div>

<script>
    let lastUpdateTime = null;
    let retryCount = 0;
    const maxRetries = 3;
    let dataHistory = []; // ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø±

    async function fetchWithCORSProxy(url) {
        try {
            const proxyUrl2 = 'https://corsproxy.io/?' + encodeURIComponent(url);
            const response2 = await fetch(proxyUrl2);
            if (!response2.ok) throw new Error(`Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡: ${response2.status}`);
            retryCount = 0; // Reset retry count on success
            const data = await response2.json();
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¯Ø§Ø¯Ù‡ ÛŒÚ© Ø¢Ø¨Ø¬Ú©Øª Ø§Ø³Øª ÛŒØ§ Ø¢Ø±Ø§ÛŒÙ‡
            if (Array.isArray(data)) {
                return data;
            } else if (typeof data === 'object' && data !== null) {
                // Ø§Ú¯Ø± Ø¯Ø§Ø¯Ù‡ ÛŒÚ© Ø¢Ø¨Ø¬Ú©Øª Ø§Ø³ØªØŒ Ø¢Ù† Ø±Ø§ Ø¯Ø± Ø¢Ø±Ø§ÛŒÙ‡ Ù‚Ø±Ø§Ø± Ø¨Ø¯Ù‡
                return [data];
            } else {
                throw new Error('ÙØ±Ù…Øª Ø¯Ø§Ø¯Ù‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
            }
            
        } catch (error2) {
            console.warn('Ø®Ø·Ø§ Ø¯Ø± proxy Ø§ÙˆÙ„:', error2);
            retryCount++;
            
            if (retryCount <= maxRetries) {
                console.log(`ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯ ${retryCount}/${maxRetries}`);
                await new Promise(resolve => setTimeout(resolve, 2000));
                return fetchWithCORSProxy(url);
            }
            
            try {
                console.log('ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø² GitHub API...');
                const apiUrl = 'https://api.github.com/repos/alefadham-droid/sensor-dashboard/contents/data/sensor-data.json';
                const response3 = await fetch(apiUrl);
                if (!response3.ok) throw new Error(`Ø®Ø·Ø§ÛŒ GitHub API: ${response3.status}`);
                const githubData = await response3.json();
                const content = atob(githubData.content.replace(/\n/g, ''));
                const parsedData = JSON.parse(content);
                
                // Ø¨Ø±Ø±Ø³ÛŒ ÙØ±Ù…Øª Ø¯Ø§Ø¯Ù‡ Ø§Ø² GitHub
                if (Array.isArray(parsedData)) {
                    return parsedData;
                } else if (typeof parsedData === 'object' && parsedData !== null) {
                    return [parsedData];
                } else {
                    throw new Error('ÙØ±Ù…Øª Ø¯Ø§Ø¯Ù‡ Ø§Ø² GitHub Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
                }
                
            } catch (error3) {
                console.error('ØªÙ…Ø§Ù… Ø±ÙˆØ´â€ŒÙ‡Ø§ Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯:', error3);
                throw error3;
            }
        }
    }

    function showStatus(message, type = 'info') {
        const statusBar = document.getElementById('statusBar');
        const statusText = document.getElementById('statusText');
        
        statusText.textContent = message;
        statusBar.className = `status-bar bg-${type} text-white`;
        statusBar.classList.remove('d-none');
        
        if (type === 'success') {
            setTimeout(() => {
                statusBar.classList.add('d-none');
            }, 3000);
        }
    }

    function updateLastUpdateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('fa-IR');
        const dateString = now.toLocaleDateString('fa-IR');
        lastUpdateTime = now;
        
        document.getElementById('lastUpdate').innerHTML = `
            <i class="bi bi-clock"></i> 
            ${dateString} - ${timeString}
        `;
    }

    async function loadSensorData() {
        try {
            showStatus('ğŸ“¥ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§...', 'info');
            const dataUrl = 'https://raw.githubusercontent.com/alefadham-droid/sensor-dashboard/main/data/sensor-data.json';
            const data = await fetchWithCORSProxy(dataUrl);
            
            console.log(`âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯:`, data);
            showStatus(`âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯`, 'success');
            updateLastUpdateTime();
            processData(data);
            
            // Auto-refresh every 15 seconds
            setTimeout(loadSensorData, 15000);
            
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§:', error);
            showStatus(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§: ${error.message}`, 'danger');
            document.getElementById('dataTable').innerHTML = `
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle"></i>
                    Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                    <br>
                    <small>${error.message}</small>
                </div>
            `;
            showSampleData();
            
            // Retry after 10 seconds on error
            setTimeout(loadSensorData, 10000);
        }
    }

    function showSampleData() {
        const sampleData = {
            id: 1,
            timestamp: new Date().toLocaleTimeString('fa-IR').slice(0, 8),
            unix_time: Math.floor(Date.now() / 1000),
            temperature: 25.5,
            humidity: 60.2,
            sensor: "AHT20",
            device: "ESP32"
        };
        
        processData([sampleData]);
        document.getElementById('dataTable').innerHTML = `
            <div class="alert alert-info">
                <i class="bi bi-info-circle"></i>
                Ø¯Ø± Ø­Ø§Ù„ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡
            </div>
            ${generateTableHTML([sampleData])}
        `;
    }

    let sensorChart = null;

    function renderChart(historyData) {
        const ctx = document.getElementById('sensorChart').getContext('2d');
        
        // ÙÙ‚Ø· Û²Û° Ø±Ú©ÙˆØ±Ø¯ Ø¢Ø®Ø± Ø±Ø§ Ù†Ú¯Ù‡ Ø¯Ø§Ø±
        const lastData = historyData.slice(-20);
        const labels = lastData.map(item => {
            if (item.timestamp) {
                return item.timestamp;
            } else if (item.time) {
                return item.time;
            } else {
                const date = new Date(item.unix_time * 1000);
                return date.toLocaleTimeString('fa-IR').slice(0, 8);
            }
        });
        
        const temps = lastData.map(item => item.temperature ?? 0);
        const hums = lastData.map(item => item.humidity ?? 0);

        if (sensorChart) {
            sensorChart.data.labels = labels;
            sensorChart.data.datasets[0].data = temps;
            sensorChart.data.datasets[1].data = hums;
            sensorChart.update('none');
        } else {
            sensorChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Ø¯Ù…Ø§ (Â°C)',
                            data: temps,
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y',
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'Ø±Ø·ÙˆØ¨Øª (%)',
                            data: hums,
                            borderColor: 'rgb(54, 162, 235)',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y1',
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    stacked: false,
                    scales: {
                        x: {
                            ticks: {
                                font: {
                                    family: 'Vazir, sans-serif',
                                    size: 11
                                },
                                maxRotation: 45
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Ø¯Ù…Ø§ (Â°C)',
                                font: {
                                    family: 'Vazir, sans-serif'
                                }
                            },
                            suggestedMin: Math.min(...temps) - 1,
                            suggestedMax: Math.max(...temps) + 1
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                            title: {
                                display: true,
                                text: 'Ø±Ø·ÙˆØ¨Øª (%)',
                                font: {
                                    family: 'Vazir, sans-serif'
                                }
                            },
                            suggestedMin: Math.min(...hums) - 5,
                            suggestedMax: Math.max(...hums) + 5
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { 
                                font: { 
                                    family: 'Vazir, sans-serif',
                                    size: 12
                                } 
                            }
                        },
                        tooltip: {
                            rtl: true,
                            titleFont: {
                                family: 'Vazir, sans-serif'
                            },
                            bodyFont: {
                                family: 'Vazir, sans-serif'
                            },
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += context.parsed.y.toFixed(1);
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }
    }

    function processData(dataArray) {
        if (!Array.isArray(dataArray) || dataArray.length === 0) {
            console.warn('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù†Ø§Ù…Ø¹ØªØ¨Ø± ÛŒØ§ Ø®Ø§Ù„ÛŒ Ù‡Ø³ØªÙ†Ø¯');
            document.getElementById('currentTemp').textContent = '--';
            document.getElementById('currentHum').textContent = '--';
            return;
        }

        // Ø¢Ø®Ø±ÛŒÙ† Ø±Ú©ÙˆØ±Ø¯ Ø±Ø§ Ø¨Ú¯ÛŒØ±
        const latest = dataArray[0];
        if (dataArray.length > 1) {
            // Ø§Ú¯Ø± Ú†Ù†Ø¯ Ø±Ú©ÙˆØ±Ø¯ Ù‡Ø³ØªØŒ Ø¢Ø®Ø±ÛŒÙ† Ø±Ø§ Ø¨Ú¯ÛŒØ±
            latest = dataArray[dataArray.length - 1];
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ù‚Ø§Ø¯ÛŒØ± ÙØ¹Ù„ÛŒ
        if (latest.temperature !== undefined) {
            document.getElementById('currentTemp').textContent = latest.temperature.toFixed(1);
        }

        if (latest.humidity !== undefined) {
            document.getElementById('currentHum').textContent = latest.humidity.toFixed(1);
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø³ØªÚ¯Ø§Ù‡
        if (latest.device) {
            document.getElementById('deviceName').textContent = latest.device;
        }
        
        if (latest.sensor) {
            document.getElementById('sensorName').textContent = latest.sensor;
        }
        
        if (latest.id !== undefined) {
            document.getElementById('recordId').textContent = latest.id;
        }

        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡
        dataHistory.push({
            ...latest,
            time: new Date().toLocaleTimeString('fa-IR').slice(0, 8)
        });
        
        // ÙÙ‚Ø· Û²Û° Ø±Ú©ÙˆØ±Ø¯ Ø¢Ø®Ø± Ø±Ø§ Ù†Ú¯Ù‡ Ø¯Ø§Ø±
        if (dataHistory.length > 20) {
            dataHistory = dataHistory.slice(-20);
        }

        updateTable([latest]);
        renderChart(dataHistory);
    }

    function updateTable(dataArray) {
        if (!Array.isArray(dataArray) || dataArray.length === 0) {
            return;
        }

        const latest = dataArray[0];
        
        let tableHTML = `
            <div class="table-responsive">
                <table class="table table-striped table-hover table-sm">
                    <thead class="table-dark">
                        <tr>
                            <th>ÙÛŒÙ„Ø¯</th>
                            <th>Ù…Ù‚Ø¯Ø§Ø±</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Ø´Ù†Ø§Ø³Ù‡ Ø±Ú©ÙˆØ±Ø¯</strong></td>
                            <td><span class="badge bg-primary">${latest.id || '--'}</span></td>
                        </tr>
                        <tr>
                            <td><strong>Ø²Ù…Ø§Ù†</strong></td>
                            <td><i class="bi bi-clock"></i> ${latest.timestamp || '--:--:--'}</td>
                        </tr>
                        <tr>
                            <td><strong>Ø²Ù…Ø§Ù† Unix</strong></td>
                            <td><span class="badge bg-secondary">${latest.unix_time || '--'}</span></td>
                        </tr>
                        <tr>
                            <td><strong>Ø¯Ù…Ø§ÛŒ ÙØ¹Ù„ÛŒ</strong></td>
                            <td>
                                <span class="badge ${latest.temperature > 25 ? 'bg-danger' : 'bg-success'}">
                                    ${latest.temperature !== undefined ? latest.temperature.toFixed(1) : '--'} Â°C
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Ø±Ø·ÙˆØ¨Øª ÙØ¹Ù„ÛŒ</strong></td>
                            <td>
                                <span class="badge ${latest.humidity > 70 ? 'bg-info' : 'bg-primary'}">
                                    ${latest.humidity !== undefined ? latest.humidity.toFixed(1) : '--'} %
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Ù†ÙˆØ¹ Ø³Ù†Ø³ÙˆØ±</strong></td>
                            <td><span class="badge bg-warning text-dark">${latest.sensor || '--'}</span></td>
                        </tr>
                        <tr>
                            <td><strong>Ù†Ø§Ù… Ø¯Ø³ØªÚ¯Ø§Ù‡</strong></td>
                            <td><span class="badge bg-dark">${latest.device || '--'}</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        `;

        document.getElementById('dataTable').innerHTML = tableHTML;
    }

    function generateTableHTML(dataArray) {
        if (!Array.isArray(dataArray) || dataArray.length === 0) {
            return '<div class="alert alert-warning">Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</div>';
        }
        
        const latest = dataArray[0];
        
        return `
            <div class="table-responsive">
                <table class="table table-striped table-hover table-sm">
                    <thead class="table-dark">
                        <tr>
                            <th>ÙÛŒÙ„Ø¯</th>
                            <th>Ù…Ù‚Ø¯Ø§Ø±</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Ø´Ù†Ø§Ø³Ù‡</td>
                            <td>${latest.id || '--'}</td>
                        </tr>
                        <tr>
                            <td>Ø²Ù…Ø§Ù†</td>
                            <td>${latest.timestamp || '--:--:--'}</td>
                        </tr>
                        <tr>
                            <td>Ø¯Ù…Ø§</td>
                            <td>${latest.temperature !== undefined ? latest.temperature.toFixed(1) + ' Â°C' : '--'}</td>
                        </tr>
                        <tr>
                            <td>Ø±Ø·ÙˆØ¨Øª</td>
                            <td>${latest.humidity !== undefined ? latest.humidity.toFixed(1) + ' %' : '--'}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        `;
    }

    document.addEventListener('DOMContentLoaded', () => {
        console.log('ğŸš€ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø³Ù†Ø³ÙˆØ± ESP32 Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯...');
        showStatus('Ø³ÛŒØ³ØªÙ… Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª', 'success');
        loadSensorData();
        
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† event listener Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø³ØªÛŒ
        document.addEventListener('keydown', (e) => {
            if (e.key === 'r' || e.key === 'R') {
                loadSensorData();
                showStatus('Ø¯Ø± Ø­Ø§Ù„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø³ØªÛŒ...', 'info');
            }
        });
        
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø± Ù†ÙˆØ§Ø± ÙˆØ¶Ø¹ÛŒØª
        const statusBar = document.getElementById('statusBar');
        statusBar.addEventListener('click', () => {
            loadSensorData();
        });
    });
</script>

<!-- ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ -->
<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet" />
</body>
</html>
